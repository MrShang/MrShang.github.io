<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favico.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16X16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: true,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="SQL语言分类 DDL: Data Definition Language 数据定义语言create， alter， drop等  DML: Data Manipulation Language 数据操纵语言insert， delete，update  DCL:  Data Controll Language 数据控制语言grant等  DQL: Data Query Language 数据查询语">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql">
<meta property="og:url" content="http://yoursite.com/2020/03/30/mysql/index.html">
<meta property="og:site_name" content="Architect">
<meta property="og:description" content="SQL语言分类 DDL: Data Definition Language 数据定义语言create， alter， drop等  DML: Data Manipulation Language 数据操纵语言insert， delete，update  DCL:  Data Controll Language 数据控制语言grant等  DQL: Data Query Language 数据查询语">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-30T03:22:43.000Z">
<meta property="article:modified_time" content="2020-03-31T07:36:19.334Z">
<meta property="article:author" content="Chris Shang">
<meta property="article:tag" content="DB, database, MySql">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/03/30/mysql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>mysql | Architect</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Architect" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Architect</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">The steps you take don't need to be big. They just need to take you in the right direction.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/30/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chris Shang">
      <meta itemprop="description" content="Java, Architect">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Architect">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          mysql
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 11:22:43" itemprop="dateCreated datePublished" datetime="2020-03-30T11:22:43+08:00">2020-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-31 15:36:19" itemprop="dateModified" datetime="2020-03-31T15:36:19+08:00">2020-03-31</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="SQL语言分类"><a href="#SQL语言分类" class="headerlink" title="SQL语言分类"></a>SQL语言分类</h2><ul>
<li><p><strong>DDL</strong>: Data Definition Language 数据定义语言create， alter， drop等</p>
</li>
<li><p><strong>DML</strong>: Data Manipulation Language 数据操纵语言insert， delete，update</p>
</li>
<li><p><strong>DCL</strong>:  Data Controll Language 数据控制语言grant等</p>
</li>
<li><p><strong>DQL</strong>: Data Query Language 数据查询语言select，from， where</p>
</li>
</ul>
<h2 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h2><p><strong>补充</strong>: </p>
<ul>
<li><p>正数的二进制的原码=反码=补码</p>
</li>
<li><p>负数的二进制的反码=原码的所有位(符号位除外)取反</p>
</li>
<li><p>补码=反码+1</p>
</li>
<li><p>计算机中负数是用补码的形式保存, 并用它参与加减法运算的, 减法会被转换为加法, 计算机中没有减法运算</p>
</li>
<li><p>1byte的有符号位的范围是 -128(1000 0000) ~ 127(0111 1111)</p>
</li>
<li><p>10000001(-127), 11111111(-1)</p>
</li>
</ul>
<p><strong>bit</strong> 1位 一般对应Java中的Boolean(0为false，1为true)</p>
<p><strong>tinyint</strong> 1字节（-128 ~ 127(有符号)，0 - 255（无符号））255</p>
<p><strong>smallint</strong> 2字节  65535</p>
<p><strong>mediumint</strong> 3字节1千多万</p>
<p><strong>int</strong> 4字节 40多亿</p>
<p><strong>bigint</strong> 8字节 非常多</p>
<p><strong>float</strong> 4字节单精度浮点数</p>
<p><strong>double</strong> 8字节双精度浮点数</p>
<p><strong>decimal(P, D)</strong>  P为小数总位数，D为精度</p>
<p><strong>date</strong> 3字节 </p>
<p><strong>time</strong> 3字节</p>
<p><strong>year</strong> 1字节</p>
<p><strong>datetime</strong> 8字节</p>
<p><strong>timestamp</strong> 4字节</p>
<h2 id="MySQL-SQL解析顺序"><a href="#MySQL-SQL解析顺序" class="headerlink" title="MySQL SQL解析顺序"></a>MySQL SQL解析顺序</h2><p>FROM –&gt; ON –&gt; LEFT JOIN –&gt; WHERE –&gt; GROUP BY –&gt; HAVING –&gt; SELECT –&gt; ORDER BY –&gt; LIMIT</p>
<p>注: MySQL where解析是从左往右; Oracle是从右往左;</p>
<h2 id="MySQL-锁"><a href="#MySQL-锁" class="headerlink" title="MySQL 锁"></a>MySQL 锁</h2><ul>
<li><p>表级锁</p>
<p>lock table {table_name} read/write;</p>
<p>unlock tables;</p>
</li>
<li><p>元数据锁, MDL(meta data lock)</p>
<p>不需要显式使用,MySQL5.5后默认加入的, 读锁之间不互斥,读写锁之间,写锁之间是互斥的.</p>
</li>
<li><p>行级锁(由存储引擎来实现,主要InnoDB)</p>
</li>
</ul>
<h2 id="MySQL-事务"><a href="#MySQL-事务" class="headerlink" title="MySQL 事务"></a>MySQL 事务</h2><ul>
<li><p><strong>A(Atomicity)</strong>, 原子性,要么全部执行,要么全部失败</p>
</li>
<li><p><strong>C(Consistency)</strong>, 在事务执行前后,数据库必须是稳定的或状态一致的</p>
</li>
<li><p><strong>I(Isolation)</strong>, 事务之间不会相互影响</p>
</li>
<li><p><strong>D(Durability)</strong>, 事务执行成功之后必须全部写入磁盘</p>
</li>
</ul>
<p>开启事务: Begin, Start Transaction</p>
<p>事务提交: commit</p>
<p>事务回滚: rollback</p>
<p><strong>事物的隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大</strong></p>
<table>
<thead>
<tr>
<th align="center">事务隔离级别</th>
<th align="center">脏读</th>
<th align="center">不可重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="center">读未提交(read-uncommitted)</td>
<td align="center">是</td>
<td align="center">是</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">读已提交(read-committed)</td>
<td align="center">否</td>
<td align="center">是</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">可重复读(repeatable-read)</td>
<td align="center">否</td>
<td align="center">否</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">串行化(serializable)</td>
<td align="center">否</td>
<td align="center">否</td>
<td align="center">否</td>
</tr>
</tbody></table>
<p>ru: 一个事务可以读另一个事务并未提交的更新结果</p>
<p>rc: 一个事务的操作结果只有在提交以后, 才可以被另一个事务读取到更新后的结果</p>
<p>rr: 整个事务中, 对同一笔数据的读取结果是相同的, 不管是否存在其他事务对共享数据的操作</p>
<p>serializable: 所有事务依次执行</p>
<ul>
<li><p><strong>脏读</strong>: 事务A读取了被另一个事务B修改, 但是并未提交的数据(如果事务B回滚,则出现脏读)</p>
</li>
<li><p><strong>不可重复读</strong>: (前提是在一个事务中)事务A和事务B对共享资源进行操作:</p>
<p>a. 事务A读取共享资源S</p>
<p>b. 事务B修改共享资源S为S1</p>
<p>c. 事务B提交共享资源S1</p>
<p>d. 事务A再次读取共享资源S</p>
<p>在rr和serializable隔离级别下, 会读取旧值</p>
<p>在ru和rc隔离级别下, 会读取到新值S1(这就是不可重复读)</p>
</li>
<li><p><strong>幻读</strong>(重点在于新增或者删除(数据条数的变化)):, 同样的条件第一次和第二次查询出来的结果不一样, 这就是幻读. 但是幻读和不可重复读的区别在于, 幻读</p>
<p>重点在于新增或者删除, 数据条数的变化. </p>
</li>
</ul>
<p>Oracle数据库默认隔离级别是 <strong>Read Committed</strong></p>
<p>Mysql默认隔离级别是 <strong>Repeatable Read</strong></p>
<p><strong>查看数据库默认隔离级别:</strong> </p>
<p>select @@tx_isolation; // 之前版本</p>
<p>select @@transaction_isolation;</p>
<p><strong>注: 对于多数应用程序,优先把隔离级别设置为Read committed;能够避免脏读,而且具有较好的并发性能.</strong></p>
<h2 id="MySQL-索引"><a href="#MySQL-索引" class="headerlink" title="MySQL 索引"></a>MySQL 索引</h2><p>索引是可以高效获取数据的数据结构. 索引本身也很大, 存储在磁盘文件中(单独的索引文件或和数据一起存储在数据文件中)</p>
<p>索引的劣势是:</p>
<ul>
<li>占用磁盘空间</li>
<li>虽然提高了查询效率,但是会降低表的更新效率. 因为进行增删改操作的时候要更新索引文件</li>
</ul>
<p><strong>单列索引</strong></p>
<ul>
<li><p><strong>普通索引</strong>: 纯粹为了查询快, 允许重复和空值</p>
<p>create index index_name on table (column(length));</p>
<p>alter table table_name add index index_name on column(length);  </p>
</li>
<li><p><strong>唯一索引</strong>: 唯一, 但允许为空</p>
<p>create unique index index_name on table(column(length));</p>
</li>
<li><p><strong>主键索引</strong>: 唯一,不为空</p>
</li>
</ul>
<p><strong>组合索引</strong></p>
<p>遵循<strong>最左匹配</strong>原则, 一般建议用组合索引代替单列索引</p>
<p><strong>全文索引</strong></p>
<p>只有在<strong>MYISAM</strong>引擎上才能使用, 只能在CHAR, VARCHAR, TEXT类型上使用</p>
<p>create fulltext index index_name on table (column(length));</p>
<p>删除索引</p>
<p>drop index index_name on table_name;</p>
<p>查看索引</p>
<p>show index from table_name;</p>
<p><strong>索引失效的几种情况</strong></p>
<ul>
<li>在索引列上做操作</li>
<li>!=, &lt;&gt;, is NULL, is not Null, like “%var”, or</li>
<li>字符串不加单引号</li>
</ul>
<h2 id="sql-执行流程"><a href="#sql-执行流程" class="headerlink" title="sql 执行流程"></a>sql 执行流程</h2><p>客户端 —&gt; 连接器(管理连接,权限验证) —&gt; 查询缓存(命中直接返回) —&gt;</p>
<p> 分析器(词法分析,语法分析) —-&gt; 优化器(执行计划生成,索引选择) —&gt; 执行器(操作引擎,返回结果) —&gt;  存储引擎(存储数据,提供读写接口)</p>
<h2 id="MySQL日志"><a href="#MySQL日志" class="headerlink" title="MySQL日志"></a>MySQL日志</h2><ul>
<li><p><strong>错误日志</strong>: 即SQL执行错误的日志</p>
</li>
<li><p><strong>二进制日志</strong></p>
<p>binlog 记录了数据库所有的ddl语句和dml语句, 主要用于数据恢复</p>
</li>
<li><p><strong>查询日志</strong>(general query log)</p>
<p>默认关闭,打开会影响性能(造成大量不必要的IO)</p>
</li>
<li><p><strong>慢查询日志</strong></p>
<p>默认关闭, <strong>slow_query_log</strong>, long_query_time=10(秒), 记录查询超过10秒的所有查询</p>
</li>
<li><p><strong>事务Redo/Undo日志</strong>, ib_logfile0和ib_logfile1</p>
</li>
<li><p><strong>中继日志</strong>, 是在主从复制环境中产生的日志,主要作用是为了从机可以从中继日志获取到主机同步过来的SQL语句,然后执行到从机中</p>
</li>
</ul>
<h2 id="InnoDB数据文件"><a href="#InnoDB数据文件" class="headerlink" title="InnoDB数据文件"></a>InnoDB数据文件</h2><ul>
<li><p>.frm: 主要包括表的数据定义信息</p>
</li>
<li><p>.ibd: 存储表数据和索引信息,一个表对应一个ibd文件</p>
</li>
<li><p>ibdata: 所有表共享一个或者多个ibdata文件</p>
</li>
</ul>
<h2 id="多版本并发控制"><a href="#多版本并发控制" class="headerlink" title="多版本并发控制"></a>多版本并发控制</h2><p>MVCC(Multi-version Concurrency Control), 最大好处是读不加锁,读写不冲突</p>
<p> 快照读(snapshot read) 读取的是记录的可见版本,不用加锁</p>
<p> 当前读(current read) 读取的是最新版本, 加锁. 插入/删除/更新操作属于当前读</p>
<p>mvcc需要注意以下几点:</p>
<ul>
<li><p>mysql的innoDB采用的是行级锁, 利用mvcc是用来提高<strong>读</strong>性能.</p>
</li>
<li><p>mvcc原理是在每一条记录后面新增两列: create version和delete version</p>
</li>
<li><p><strong>insert</strong>的时候create version加1; </p>
<p><strong>update</strong>的时候把 老记录的delete version变为当前事务版本号, create version也是当前事务版本号; </p>
<p><strong>delete</strong>的时候把delete version变为当前事务版本号; </p>
<p><strong>select</strong>的时候符合以下条件的记录可以被查出来:</p>
<ul>
<li>delete version大于当前事务版本号的记录; </li>
<li>create version 小于或者等于当前事务版本号</li>
</ul>
</li>
<li><p>只针对read commited和repeatable read两种; 因为读未提交(read uncommited)是读未提交的, 所以不存在版本问题; 序列化(serializable)是会所有的行都加锁.</p>
</li>
</ul>
<h2 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h2><p>explain 会产生10多列</p>
<ul>
<li><p><strong>id</strong>: id若相同,执行顺序由上向下. id不同(有子查询), id越大,优先级越高</p>
</li>
<li><p><strong>select_type</strong>: 查询类型</p>
</li>
<li><p><strong>simple</strong>(无连接,无子查询)</p>
</li>
<li><p><strong>primary</strong>(有子查询或union操作), 外层的为primary</p>
</li>
<li><p><strong>union</strong></p>
</li>
<li><p><strong>dependent</strong> <strong>union</strong></p>
</li>
<li><p><strong>union result</strong></p>
</li>
<li><p><strong>subquery</strong></p>
</li>
<li><p><strong>dependent subquery</strong></p>
</li>
<li><p><strong>derived</strong></p>
</li>
<li><p><strong>table</strong></p>
</li>
</ul>
<p>type: 依次从好到差</p>
<ul>
<li><p><strong>system</strong>,表中只有一行数据或是空表</p>
</li>
<li><p><strong>const</strong>,使用唯一索引或者主键</p>
</li>
<li><p><strong>eq_ref</strong>,连接查询, 连接字段为主键或者唯一索引</p>
</li>
<li><p><strong>ref</strong>, 针对非唯一索引, 使用等值查询或者是使用了最左前缀规则索引的查询</p>
</li>
<li><p><strong>fulltext</strong>, 全文索引,优先级高于普通索引</p>
</li>
<li><p><strong>ref_or_null</strong>, 类似ref,但增加了null值的比较</p>
</li>
<li><p><strong>unique_subquery</strong>, 用于where查询的in查询,子查询返回不重复的唯一值</p>
</li>
<li><p><strong>index_subquery</strong>, </p>
</li>
<li><p><strong>range</strong>, 索引范围扫描&gt;, &lt;, is null, between, in, like等</p>
</li>
<li><p><strong>index_merge</strong>, </p>
</li>
<li><p><strong>index</strong>, 索引全匹配扫描</p>
</li>
<li><p><strong>all</strong>.</p>
<p>除all之外,其他的type都可以使用到索引, <strong>最少要使用到range级别</strong></p>
</li>
</ul>
<p>possible_keys, 此次查询中可能选用的索引</p>
<p>key, 真正使用到的索引</p>
<p>key_len, 使用到索引的长度(如果使用了一个索引,那么长度即为该字段的长度), 注:排序和分组即使用到了索引也不会计算到key_len中.</p>
<p>ref, 若是常数等值查询,这里会显示const; 连接查询显示驱动表的关键字段; 如果内部有隐式转换, 此处显示func</p>
<p>rows, 扫描的行数, 不是精确值(因为InnoDB使用了MVCC)</p>
<p>extra, 一些其他重要的额外信息, distinct, no table used, using filesort(排序中没用到索引),</p>
<p> using index(用到了覆盖索引, 如果同时出现using where表明用到了索引查找,如果没有表明用到了索引查询)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">全值匹配我最爱,最左前缀要遵守;</span><br><span class="line">带头大哥不能死,中间兄弟不能断;</span><br><span class="line">索引列上少计算,范围之后全失效;</span><br><span class="line">LIKE百分写最右,覆盖索引不写星;</span><br><span class="line">不等空值还有or,索引失效要少用;</span><br></pre></td></tr></table></figure>

<h2 id="数据库范式"><a href="#数据库范式" class="headerlink" title="数据库范式"></a>数据库范式</h2><ul>
<li><p>第一范式: 列不可再分(根据需求,如地址的拆分, 姓和名的拆分)</p>
</li>
<li><p>第二范式: 表的唯一性; 表必须有主键,针对联合主键的情况,表中的列不能只与联合主键的某列相关</p>
</li>
<li><p>第三范式: 表中的每一列数据都和主键直接相关,而不能间接相关,其实就是消除冗余字段(但是有时候必须有冗余)</p>
</li>
</ul>
<h2 id="mysql-优化-执行计划explain-慢查询日志-Query-Profiler"><a href="#mysql-优化-执行计划explain-慢查询日志-Query-Profiler" class="headerlink" title="mysql 优化(执行计划explain, 慢查询日志, Query Profiler)"></a>mysql 优化(<strong>执行计划explain</strong>, <strong>慢查询日志</strong>, <strong>Query Profiler</strong>)</h2><ul>
<li><p>慢查询日志(show variables like ‘%slow%’;)</p>
</li>
<li><p>慢查询日志分析工具: mysqldumpslow(mysql自带的)</p>
<p>常用参数: mysqldumpslow -s t -t 10 -g “left join”</p>
<p>-s: 按什么排序</p>
<p>-t: 返回几条数据</p>
<p>-g: 正则</p>
</li>
<li><p>另一种工具: percona-toolkit</p>
</li>
</ul>
<p>Query Profiler分析语句, 能定位出一条SQL语句执行的<strong>各种资源消耗情况</strong>, 比如<strong>CPU, IO</strong>等, 以及该<strong>SQL执行所耗费的时间</strong>等.</p>
<p><strong>select @@profiling</strong>;</p>
<p>sql优化:</p>
<ul>
<li><p>如果预先知道select的查询结果是一条,最好使用LIMIT 1,可停止全表扫描</p>
</li>
<li><p>分页offset过大时: select * from user where id &gt;= (select id from user order by id limit 100000,1) limit 20;</p>
</li>
<li><p>尽量不使用count(*), 使用count(主键)</p>
</li>
<li><p>count(*), 遍历所有行</p>
</li>
<li><p>count(列), 查询指定列不为null的行数</p>
</li>
</ul>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p><strong>主对外工作,从对内备份</strong></p>
<ul>
<li><p>配置:在配置文件[mysqld]段下添加:</p>
<p># 启用二进制日志</p>
<p>log-bin=mysql-bin</p>
<p># 服务器唯一ID, 一般取IP最后一段</p>
<p>server-id = 133</p>
</li>
<li><p>登录客户端, 给从机授备份权限: grant replication slave on <em>.</em> to ‘从机MySQL用户名‘@’从机IP’ identified by ‘从机MySQL密码’; </p>
</li>
<li><p>从服务器配置, 修改my.conf文件,</p>
<p>[mysqld]</p>
<p>server-id=135</p>
<p>在从机上执行:</p>
<p>change master to master_host = ‘192.168.10.135’, master_port= 3306, master_user=’’, master_password=’’, mysql_log_file=’’, master_log_pos=123(此值为从binlog的哪个位置开始复制) </p>
</li>
</ul>
<p><strong>mysql复制的优点：</strong></p>
<ul>
<li><p>如果主库出现问题，可以快速切换到从库提供服务</p>
</li>
<li><p>可以在从库执行查询操作(更新不频繁的数据)，降低主库的访问压力。</p>
</li>
<li><p>可以在从库进行备份，以免备份期间影响主库的服务。</p>
</li>
</ul>
<p><strong>主从复制原理:</strong></p>
<ul>
<li>mysql在提交时会把变更存在binlog日志中;</li>
<li>mysql推送二进制文件binlog到从库relay log,从库根据relay log做数据变更</li>
</ul>
<p><strong>共3个线程: Binlog dump线程(主库), I/O线程和SQL线程(从库)</strong></p>
<ul>
<li>当启动复制(start slave)时, 创建I/O线程连接主库</li>
<li>主库创建Binlog dump线程读取事件发送到I/O线程</li>
<li>I/O线程读取到数据放入从机的relay log中</li>
<li>之后从机的SQL线程读取中继日志更新数据库</li>
</ul>
<h2 id="mysql聚集索引和非聚集索引"><a href="#mysql聚集索引和非聚集索引" class="headerlink" title="mysql聚集索引和非聚集索引"></a>mysql聚集索引和非聚集索引</h2><ul>
<li><p><strong>聚集索引</strong>是指索引值的顺序与数据的存储顺序一致, 通常是<strong>主键</strong></p>
</li>
<li><p><strong>非聚集索引</strong>是指索引值的顺序与数据的存储顺序通常不一致, 如<strong>普通索引</strong>, <strong>唯一索引</strong>, <strong>联合索引</strong>等;</p>
</li>
<li><p>如果一个表中存在主键, 那么该主键就为聚集索引; </p>
</li>
<li><p>如果没有主键, 那么第一个非空索引为聚集索引;</p>
</li>
<li><p>如果没有合适的索引, 那么InnoDB内部会生成一个隐藏的主键作为聚集索引, 该聚集索引是6个字节的列, 自增;</p>
</li>
</ul>
<h2 id="mysql-char和varchar的区别"><a href="#mysql-char和varchar的区别" class="headerlink" title="mysql char和varchar的区别"></a>mysql char和varchar的区别</h2><p>char(n)中的n是字符数, 范围是0~255(额外需要1到2个字节来存长度)</p>
<p>varchar(n)中的n也是字符数，但是最大值需要通过编码来算, 不能超过65535字节(从中还需要拿出1到2个字节来存长度)</p>
<p>一般定长的数据选用char类型, 比如身份证号, 手机号, 电话等. 长度变化很大的可以使用varchar类型</p>
<p>经测试, 100万条的数据, char和varchar的数据类型, 无论是否添加索引, varchar的搜索都要更快一点</p>
<h2 id="持续更新-注"><a href="#持续更新-注" class="headerlink" title="持续更新(注)"></a>持续更新(注)</h2><p>该篇blog并不代表该知识点的所有内容, 在今后的工作学习中, <strong><font color="#dd0000">持续更新</font></strong>! 如对blog中的观点有异议/建议,请发送email至: <span class="exturl" data-url="bWFpbHRvOnNoY2hhb3NodWFpQGZveG1haWwuY29t" title="mailto:shchaoshuai@foxmail.com">shchaoshuai@foxmail.com<i class="fa fa-external-link"></i></span>, 感谢您的阅读.</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>Thanks for your donating.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Chris Shang WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Chris Shang Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/DB-database-MySql/" rel="tag"># DB, database, MySql</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/20/jvm/" rel="prev" title="jvm">
      <i class="fa fa-chevron-left"></i> jvm
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/31/zookeeper/" rel="next" title="zookeeper">
      zookeeper <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL语言分类"><span class="nav-number">1.</span> <span class="nav-text">SQL语言分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL数据类型"><span class="nav-number">2.</span> <span class="nav-text">MySQL数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-SQL解析顺序"><span class="nav-number">3.</span> <span class="nav-text">MySQL SQL解析顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-锁"><span class="nav-number">4.</span> <span class="nav-text">MySQL 锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-事务"><span class="nav-number">5.</span> <span class="nav-text">MySQL 事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-索引"><span class="nav-number">6.</span> <span class="nav-text">MySQL 索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql-执行流程"><span class="nav-number">7.</span> <span class="nav-text">sql 执行流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL日志"><span class="nav-number">8.</span> <span class="nav-text">MySQL日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB数据文件"><span class="nav-number">9.</span> <span class="nav-text">InnoDB数据文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多版本并发控制"><span class="nav-number">10.</span> <span class="nav-text">多版本并发控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行计划"><span class="nav-number">11.</span> <span class="nav-text">执行计划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库范式"><span class="nav-number">12.</span> <span class="nav-text">数据库范式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql-优化-执行计划explain-慢查询日志-Query-Profiler"><span class="nav-number">13.</span> <span class="nav-text">mysql 优化(执行计划explain, 慢查询日志, Query Profiler)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主从复制"><span class="nav-number">14.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql聚集索引和非聚集索引"><span class="nav-number">15.</span> <span class="nav-text">mysql聚集索引和非聚集索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql-char和varchar的区别"><span class="nav-number">16.</span> <span class="nav-text">mysql char和varchar的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#持续更新-注"><span class="nav-number">17.</span> <span class="nav-text">持续更新(注)</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chris Shang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Chris Shang</p>
  <div class="site-description" itemprop="description">Java, Architect</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01yU2hhbmc=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;MrShang"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNoY2hhb3NodWFpQGZveGFpbC5jb20=" title="E-Mail → mailto:shchaoshuai@foxail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chris Shang</span>
</div>
  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <span class="exturl theme-link" data-url="aHR0cHM6Ly9tdXNlLnRoZW1lLW5leHQub3Jn">NexT.Muse</span> v7.7.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  

  

</body>
</html>
